# policedatR

An R package for acquiring, augmenting and analysing stop and search data from the UK Police API.

## Installation

In its current form policedatR requires an RTools installation. The simplest way of installing RTools is to use the package 'installr':

```
# check if you already have installr installed and install if not.
packages <- c("installr")
pkg_not_install <- packages[!(packages %in% installed.packages()[,"Package"])]
lapply(pkg_not_install, install.packages, dependencies = TRUE)
lapply(packages, library, character.only = TRUE)

# run install.rtools. This will check for installation and update to latest
installr::install.Rtools()
```

Then use the devtools package to install policedatR

```
# check if you already have devtools installed and install if not.
packages <- c("devtools")
pkg_not_install <- packages[!(packages %in% installed.packages()[,"Package"])]
lapply(pkg_not_install, install.packages, dependencies = TRUE)
lapply(packages, library, character.only = TRUE)

# install policedatR
devtools::install_github("JustKnowledge-UK/policedatR")

# add policedatR to library
library(policedatR)
```

## Usage

A typical pipeline involves acquiring stop data for specific areas and/or time periods then calculating descriptive statistics such as stop rates, objects of searches, find rates, and ethnic disparities. This can be achieved with three main functions, and aided by a few helper functions.

The `get_*_data` family of functions acquires data by geographic area over a time period. For example, we could be interested to get data by local authority in the Greater London region. To do so we use the `get_lad_data()` function. The first argument this can take is `subset`, which is a named list defining the areas for which data are required. Names correspond to the area variable on which to subset. Values correspond to the desired values of the area variable. You can use `area_variables()` to get a list of the options for the area variable, and `list_areas()` to get the options for the values. 

If we are interested in getting local authority data for Greater London, first we want to know what the region variable name is, then the values that the region variable can take. 

```
area_variables()
list_areas(area_type = "region")
```

Running the above indicates that the region variable is "rgn22nm", and the value for Greater London is "London". We can input these into the subset option as follows

```
london_data <- get_lad_data(subset = list("rgn22nm" = "London"))
```

By default this function will acquire data 12 months backwards from the most recent month for which data are available. There are options for specifying different periods explained in the function documentation.

Once we have data, we can do some basic analysis. The analyse_anything() function takes a tibble generated by policedatR and produces counts and percentages of stops based on a combination of grouping variables. The `analysis_variables` argument defines an ordered set of grouping variables for which counts will be produced. For example, ⁠`analysis_variables = c("area","period","object")` will count the number of stops for each object of search within each area and time period. The percentage denominator is the sum of counts within the final grouping level. In the example above, the denominator would be the total number of stops within each area-period combination. The options for defining `analysis_variables` can be found using `show_analysis_variables()`.

Disparities by ethnicity are of course a key concern. To count the number of stops of people of each ethnicity we could use the `analysis_variables = c("area","period","ethnicity")`. When including ethnicity, we must specificy how ethnicity is treated. In the data there is 'self-defined ethnicity' and 'officer-defined'. Self-defined consists of 18 detailed categories. Officer-defined consists of five aggregated categories. Self-defined may be more accurate but may have more NAs as citizens do not have to respond. Officer-defined may be less accurate but technically should have no NAs as officers must record this if self-defined has not been provided. If specifying self-defined, you can additionally choose whether to aggregate the categories down to five. A typical code would be:

```
ethnicity_summary <- analyse_anything(data, area_variables = c("area","period","ethnicity"), ethnicity_definition = "self", collapse_ethnicity = TRUE, period = 12)
```

The period argument specifies how many months each period for analysis should be. If this was e.g. 1, this would produce account for each month within each area.

The output of the above function is a dataframe containing the counts by area-period-ethnicity, and a percentage representing the proprotion of counts of each ethnicity as a function of the total counts within each area-period.

We may be interested to quantify the extent of a disparity between two ethnicities. To do this, you can use the `calculate_riskratio()` function. This function essentially performs the `analyse_anything()` function above but additionally merges this result with Census 2021 population estimates to calculate the risk ratio (using `epitools::riskratio()`) of being stopped for one ethnicity versus another. The same ethnicity argument options as above are available. In addition, you must specify what `comparison` you want to make. This is a character vector, where the first element should be the reference ethnicity, and the second element the 'test' ethnicity. If you don't know what the values of ethnicity are, passing `comparison = NULL` will produce a list of the ethnicities present in the data and will prompt you to choose your reference and test categories.

If we are interested in quantifying the extent of the disparity between Black and White citizens, we run:

```
disparity <- calculate_riskratio(data, ethnicity_definition = "self", collapse_ethnicity = TRUE, comparison = c("white","black"), period = 12)
```

The output will be a dataframe containing the counts and rates per population by area-period-ethnicity for only the ethnicities in `comparison`, plus the risk ratio and associated confidence intervals.


## Notes on licencing

Data acquired using policedatR is published by data.police.uk under [Open Government Licence v3.0](https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/)

policedatR makes use of lookups and boundary data from the Office for National Statistics [Open Geography Portal](https://geoportal.statistics.gov.uk/). These data are also licenced [Open Government Licence v3.0](https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/)
